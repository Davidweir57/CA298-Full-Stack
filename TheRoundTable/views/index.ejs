<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>

    <table id="product-table">
      <tr>
      <td>Name</td>
      <td>Desccription</td>
      <td>Price</td>
      </tr>
     </table>

     <form id="login-form", action="." method="POST">
      <label for="username">Username</label>
      <input type="text" id="username" name="username" placeholder="Your username"
     />
      <label for="password">Password</label>
      <input type="password" id="password" name="password" placeholder="Your
     password" />
      <input type="submit" value="Submit" />
     </form>

    <script>
      fetch("http://127.0.0.1:8000/api/products/?format=json")
      .then(response => response.json())
      .then(data => {
        console.log(data)
        data.forEach(element => {
          // for each row in the data
          // create a new <tr> elemenet
          let table = document.getElementById("product-table")
          let newRow = document.createElement("tr") // <tr> innerhtml </tr>
          table.appendChild(newRow)

          // create td elements for Name description and price
          let name = document.createElement("td") // <td> innerhtml </td>
          name.innerHTML = element['name']
          newRow.appendChild(name)

          let descr = document.createElement("td") // <td> innerhtml </td>
          descr.innerHTML = element['description']
          newRow.appendChild(descr)

          let price = document.createElement("td") // <td> innerhtml </td>
          price.innerHTML = element['price']
          newRow.appendChild(price)
        });
      });

      let loginform = document.getElementById("login-form")
      loginform.addEventListener("submit", (event) => {
        event.preventDefault();

        let user = document.getElementById("username").value
        let pw = document.getElementById("password").value

        fetch("http://127.0.0.1:8000/token/", {
          method:'POST',  // we're sending a post request
          headers:{
            'Accept': 'application/json', // We accept Json data as a response from the server
            'Content-Type': 'application/json' // We're sending Json data
          },
          body:JSON.stringify({username:user, password:pw}) 
        }).then(response => response.json()).then(data => console.log(data))
          // get the data returned from the server
          console.log(data) // log the data in the console (so we can look at it)
          window.token = data['token'] // save it to a global variable called window.token

      }, true)
    </script>
  </body>
</html>
